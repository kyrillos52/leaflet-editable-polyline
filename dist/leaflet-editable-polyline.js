!function(e){var n={};function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n){L.Polyline.polylineEditor=L.Polyline.extend({_prepareMapIfNeeded:function(){var e=this;e._changed=!1,null==this._map._editablePolylines&&(this._map._editablePolylines=[],this._map._editablePolylinesEnabled=!0,this._options.newPolylines&&(console.log("click na map"),e._map.on("dblclick",function(n){if(console.log("click, target="+(n.target==e._map)+" type="+n.type),!e._map.isEditablePolylinesBusy()){var t=n.latlng;if(!e._options.newPolylineConfirmMessage||confirm(e._options.newPolylineConfirmMessage)){L.Polyline.PolylineEditor([t],e._options,[{originalPolylineNo:null,originalPointNo:null}]).addTo(e._map),e._showBoundMarkers(),e._changed=!0}}})),this._map.isEditablePolylinesBusy=function(){for(var e=0;e<this._editablePolylines.length;e++)if(this._editablePolylines[e]._isBusy())return!0;return!1},this._map.setEditablePolylinesEnabled=function(e){this._editablePolylinesEnabled=e;for(var n=0;n<this._editablePolylines.length;n++){var t=this._editablePolylines[n];e?t._showBoundMarkers():t._hideAll()}},this._map.getEditablePolylines=function(){return this._editablePolylines},this._map.fixAroundEditablePoint=function(e){for(var n=0;n<this._editablePolylines.length;n++){this._editablePolylines[n]._reloadPolyline(e)}})},_addMethods:function(){var e=this;this._init=function(n,t){this._prepareMapIfNeeded(),this._parseOptions(n),this._markers=[];for(var i=this.getLatLngs(),o=i.length,r=0;r<o;r++){var a=this._addMarkers(r,i[r]);"context"in a||(a.context={},null!=e._contexts&&(a.context=t[r])),!a.context||"originalPointNo"in a.context||(a.context.originalPointNo=r),!a.context||"originalPolylineNo"in a.context||(a.context.originalPolylineNo=e._map._editablePolylines.length)}this._map;this._map.on("zoomend",function(n){e._showBoundMarkers()}),this._map.on("moveend",function(n){e._showBoundMarkers()}),this._desiredPolylineNo&&null!=this._desiredPolylineNo?this._map._editablePolylines.splice(this._desiredPolylineNo,0,this):this._map._editablePolylines.push(this)},this._isBusy=function(){return e._busy},this._setBusy=function(n){e._busy=n},this.getPoints=function(){return this._markers},this.isChanged=function(){return this._changed},this._parseOptions=function(e){e||(e={}),"maxMarkers"in e||(e.maxMarkers=100),"newPolylines"in e||(e.newPolylines=!1),"newPolylineConfirmMessage"in e||(e.newPolylineConfirmMessage=""),"addFirstLastPointEvent"in e||(e.addFirstLastPointEvent="click"),"customPointListeners"in e||(e.customPointListeners={}),"customNewPointListeners"in e||(e.customNewPointListeners={}),this._options=e,e.pointIcon||(this._options.pointIcon=L.icon({iconUrl:"../static/img/editmarker.png",iconSize:[11,11],iconAnchor:[6,6]})),e.newPointIcon||(this._options.newPointIcon=L.icon({iconUrl:"../static/img/editmarker2.png",iconSize:[11,11],iconAnchor:[6,6]}))},this._showBoundMarkers=function(){if(e._map)if(this._setBusy(!1),e._map._editablePolylinesEnabled){var n=e._map.getBounds(),t=0;for(var i in e._map._editablePolylines){var o=e._map._editablePolylines[i];for(var r in o._markers){var a=o._markers[r];n.contains(a.getLatLng())&&(t+=1)}}for(var i in e._map._editablePolylines){o=e._map._editablePolylines[i];for(var r in o._markers){a=o._markers[r];t<e._options.maxMarkers?(e._setMarkerVisible(a,n.contains(a.getLatLng())),e._setMarkerVisible(a.newPointMarker,r>0&&n.contains(a.getLatLng()))):(e._setMarkerVisible(a,!1),e._setMarkerVisible(a.newPointMarker,!1))}}}else console.log("Do not show because editing is disabled")},this._hideAll=function(n){for(var t in this._setBusy(!0),e._map._editablePolylines){console.log("hide "+t+" markers");var i=e._map._editablePolylines[t];for(var o in i._markers){var r=i._markers[o];null!=n&&n==r||i._setMarkerVisible(r,!1),null!=n&&n==r.newPointMarker||i._setMarkerVisible(r.newPointMarker,!1)}}},this._setMarkerVisible=function(e,n){if(e){var t=this._map;n?(e._visible||(e._map?t.addLayer(e):e.addTo(t),e._map=t),e._visible=!0):(e._visible&&t.removeLayer(e),e._visible=!1)}},this._reloadPolyline=function(n){e.setLatLngs(e._getMarkerLatLngs()),null!=n&&e._fixAround(n),e._showBoundMarkers(),e._changed=!0},this._addMarkers=function(e,n,t){var i=this,o=this.getLatLngs(),r=L.marker(n,{draggable:!0,icon:this._options.pointIcon});r.newPointMarker=null,r.on("dragstart",function(e){var n=i._getPointNo(e.target),t=n&&n>0?i._markers[n-1].getLatLng():null,o=n<i._markers.length-1?i._markers[n+1].getLatLng():null;i._setupDragLines(r,t,o),i._hideAll(r)}),r.on("dragend",function(e){e.target;var n=i._getPointNo(e.target);setTimeout(function(){i._reloadPolyline(n)},25)}),r.on("contextmenu",function(e){var n=e.target,t=i._getPointNo(e.target);i._map.removeLayer(n),i._map.removeLayer(s),i._markers.splice(t,1),i._reloadPolyline(t)}),r.on(i._options.addFirstLastPointEvent,function(e){console.log("click on marker");var n=e.target,t=i._getPointNo(e.target);console.log("pointNo="+t+" that._markers.length="+i._markers.length),e.dont,0==t||t==i._markers.length-1?(console.log("first or last"),i._prepareForNewPoint(n,0==t?0:t+1)):console.log("not first or last")});var a=o[0==e?e:e-1],s=L.marker([(n.lat+a.lat)/2,(n.lng+a.lng)/2],{draggable:!0,icon:this._options.newPointIcon});if(r.newPointMarker=s,s.on("dragstart",function(e){var n=i._getPointNo(e.target),t=i._markers[n-1].getLatLng(),o=i._markers[n].getLatLng();i._setupDragLines(r.newPointMarker,t,o),i._hideAll(r.newPointMarker)}),s.on("dragend",function(e){var n=e.target,t=i._getPointNo(e.target);i._addMarkers(t,n.getLatLng(),!0),setTimeout(function(){i._reloadPolyline()},25)}),s.on("contextmenu",function(e){var n=e.target,t=i._getPointNo(n);i.getPoints();i._hideAll();var o=i._markers.slice(t,t.length);i._markers.splice(t,i._markers.length-t),i._reloadPolyline();for(var r=[],a=[],s=0;s<o.length;s++){n=o[s];r.push(n.getLatLng()),a.push(n.context)}console.log("points:"+r),console.log("contexts:"+a);var l=i._map._editablePolylines.indexOf(i);L.Polyline.PolylineEditor(r,i._options,a,l+1).addTo(i._map),i._showBoundMarkers()}),this._markers.splice(e,0,r),i._options.customPointListeners)for(var l in i._options.customPointListeners)r.on(l,i._options.customPointListeners[l]);if(i._options.customNewPointListeners)for(var l in i._options.customNewPointListeners)s.on(l,i._options.customNewPointListeners[l]);return t&&this._fixAround(e),r},this._prepareForNewPoint=function(n,t){setTimeout(function(){e._hideAll(),e._setupDragLines(n,n.getLatLng()),e._map.once("click",function(n){1==e._markers.length&&(t+=1),console.log("dodajemo na "+t+" - "+n.latlng),e._addMarkers(t,n.latlng,!0),e._reloadPolyline()})},100)},this._fixAround=function(n){if("number"==typeof n)var t=n;else t=e._markers.indexOf(n);if(!(t<0)){var i=0==t?null:e._markers[t-1],o=e._markers[t],r=t<e._markers.length-1?e._markers[t+1]:null;o&&i&&o.newPointMarker.setLatLng([(i.getLatLng().lat+o.getLatLng().lat)/2,(i.getLatLng().lng+o.getLatLng().lng)/2]),o&&r&&r.newPointMarker.setLatLng([(o.getLatLng().lat+r.getLatLng().lat)/2,(o.getLatLng().lng+r.getLatLng().lng)/2])}},this._getPointNo=function(e){for(var n=0;n<this._markers.length;n++)if(e==this._markers[n]||e==this._markers[n].newPointMarker)return n;return-1},this._getMarkerLatLngs=function(){for(var e=[],n=0;n<this._markers.length;n++)e.push(this._markers[n].getLatLng());return e},this._setupDragLines=function(n,t,i){var o=null,r=null;t&&(o=L.polyline([n.getLatLng(),t],{dasharray:"5,1",weight:1}).addTo(e._map)),i&&(r=L.polyline([n.getLatLng(),i],{dasharray:"5,1",weight:1}).addTo(e._map));var a=function(e){o&&o.setLatLngs([e.latlng,t]),r&&r.setLatLngs([e.latlng,i])},s=function(t){e._map&&(e._map.off("mousemove",a),n.off("dragend",s),o&&e._map.removeLayer(o),r&&e._map.removeLayer(r),console.log("STOPPED"),t.target!=e._map&&e._map.fire("click",t))};e._map.on("mousemove",a),n.on("dragend",s),e._map.once("click",s),n.once("click",s),o&&o.once("click",s),r&&r.once("click",s)}}}),L.Polyline.polylineEditor.addInitHook(function(){this.on("add",function(e){return this._map=e.target._map,this._addMethods(),this._busy=!1,this._initialized=!1,this._init(this._options,this._contexts),this._initialized=!0,this}),this.on("remove",function(e){var n=e.target,t=n._map,i=t.getEditablePolylines(),o=i.indexOf(n);o>-1&&(i[o]._markers.forEach(function(e){t.removeLayer(e),e.newPointMarker&&t.removeLayer(e.newPointMarker)}),i.splice(o,1))})}),L.Polyline.PolylineEditor=function(e,n,t,i){n.prepareOptions&&n.prepareOptions(n);var o=new L.Polyline.polylineEditor(e,n);return o._options=n,o._contexts=t,o._desiredPolylineNo=i,o}}]);